<form [formGroup]="form" (ngSubmit)="onSubmit()" class="producto-container">
  <!-- TÍTULO -->
  <h2 class="form-title">
    {{ isEditMode ? 'Modificar Producto' : 'Registrar Producto' }}
  </h2>

  <!-- DIVISOR -->
  <hr class="custom-divider" />

  <!-- SECCIÓN DATOS DEL PRODUCTO -->
  <div class="section-header">
    <mat-icon>inventory_2</mat-icon>
    <span>Datos del Producto</span>
  </div>

  <div class="form-container">
    <!-- Código solo en modo edición -->
    <div *ngIf="isEditMode" class="form-group full-width">
      <label for="code">Código</label>
      <input id="code" type="text" formControlName="code" readonly />
    </div>

    <!-- Nombre -->
    <div class="form-group full-width">
      <label for="name">Nombre <span class="required">*</span></label>
      <input id="name" type="text" formControlName="name" placeholder="Ingrese el nombre del producto" />
      <div class="error" *ngIf="form.get('name')?.invalid && form.get('name')?.touched">
        <span *ngIf="form.get('name')?.hasError('required')">El nombre es obligatorio.</span>
        <span *ngIf="form.get('name')?.hasError('maxlength')">Máximo 70 caracteres.</span>
        <span *ngIf="form.get('name')?.hasError('multipleSpaces')">No se permiten múltiples espacios.</span>
      </div>
    </div>

    <!-- Descripción -->
    <div class="form-group full-width">
      <label for="description">Descripción <span class="required">*</span></label>
      <textarea id="description" formControlName="description" rows="3" placeholder="Ingrese una descripción del producto"></textarea>
      <div class="error" *ngIf="form.get('description')?.invalid && form.get('description')?.touched">
        <span *ngIf="form.get('description')?.hasError('required')">La descripción es obligatoria.</span>
        <span *ngIf="form.get('description')?.hasError('minlength')">Mínimo 5 caracteres.</span>
        <span *ngIf="form.get('description')?.hasError('maxlength')">Máximo 160 caracteres.</span>
        <span *ngIf="form.get('description')?.hasError('multipleSpaces')">No se permiten múltiples espacios.</span>
      </div>
    </div>

    <!-- Volumen / Unidad / Stock / Precio -->
    <div class="form-row">
      <div class="form-group">
        <label for="volumeWeight">Volumen/Peso <span class="required">*</span></label>
        <input id="volumeWeight" type="number" step="0.01" formControlName="volumeWeight" placeholder="0.00" />
        <div class="error" *ngIf="form.get('volumeWeight')?.invalid && form.get('volumeWeight')?.touched">
          <span *ngIf="form.get('volumeWeight')?.hasError('required')">Campo obligatorio.</span>
          <span *ngIf="form.get('volumeWeight')?.hasError('min')">Debe ser mayor a 0.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="unitMeasure">Unidad de Medida <span class="required">*</span></label>
        <select id="unitMeasure" formControlName="unitMeasure">
          <option value="">Seleccione...</option>
          <option value="Kilogramos">Kilogramos</option>
          <option value="Gramos">Gramos</option>
          <option value="Litros">Litros</option>
          <option value="Mililitros">Mililitros</option>
          <option value="Unidades">Unidades</option>
          <option value="Cajas">Cajas</option>
          <option value="Paquetes">Paquetes</option>
        </select>
        <div class="error" *ngIf="form.get('unitMeasure')?.invalid && form.get('unitMeasure')?.touched">
          <span *ngIf="form.get('unitMeasure')?.hasError('required')">Seleccione una unidad.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="stock">Stock <span class="required">*</span></label>
        <input id="stock" type="number" formControlName="stock" placeholder="1" />
        <div class="error" *ngIf="form.get('stock')?.invalid && form.get('stock')?.touched">
          <span *ngIf="form.get('stock')?.hasError('required')">Campo obligatorio.</span>
          <span *ngIf="form.get('stock')?.hasError('min')">Debe ser mayor a 0.</span>
          <span *ngIf="form.get('stock')?.hasError('pattern')">Solo números enteros.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="price">Precio <span class="required">*</span></label>
        <input id="price" type="number" formControlName="price" step="0.01" placeholder="0.00" />
        <div class="error" *ngIf="form.get('price')?.invalid && form.get('price')?.touched">
          <span *ngIf="form.get('price')?.hasError('required')">Campo obligatorio.</span>
          <span *ngIf="form.get('price')?.hasError('min')">Debe ser mayor a 0.</span>
          <span *ngIf="form.get('price')?.hasError('max')">Máximo 10,000.</span>
          <span *ngIf="form.get('price')?.hasError('pattern')">Formato inválido (ej: 10.50).</span>
        </div>
      </div>
    </div>

    <!-- Categoría + Fecha -->
    <div class="form-row">
      <div class="form-group">
        <label for="category">Categoría <span class="required">*</span></label>
        <select id="category" formControlName="category">
          <option value="">Seleccione...</option>
          <option value="Alimentos">Alimentos</option>
          <option value="Bebidas">Bebidas</option>
          <option value="Limpieza">Limpieza</option>
          <option value="Cuidado Personal">Cuidado Personal</option>
          <option value="Hogar">Hogar</option>
          <option value="Otros">Otros</option>
        </select>
        <div class="error" *ngIf="form.get('category')?.invalid && form.get('category')?.touched">
          <span *ngIf="form.get('category')?.hasError('required')">Seleccione una categoría.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="expirationDate">Fecha de Vencimiento</label>
        <input id="expirationDate" type="date" formControlName="expirationDate" />
        <div class="error" *ngIf="form.get('expirationDate')?.invalid && form.get('expirationDate')?.touched">
          <span *ngIf="form.get('expirationDate')?.hasError('futureDate')">Debe tener mínimo 30 días.</span>
          <span *ngIf="form.get('expirationDate')?.hasError('tooFarDate')">Máximo 5 años.</span>
          <span *ngIf="form.get('expirationDate')?.hasError('noSunday')">No puede ser domingo.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- BOTONES -->
  <div class="button-group">
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid" class="btn-primary">
      <mat-icon>save</mat-icon>
      {{ isEditMode ? 'Actualizar' : 'Registrar' }}
    </button>

    <button mat-raised-button type="button" (click)="onCancel()" class="btn-warn">
      <mat-icon>close</mat-icon>
      Cancelar
    </button>
  </div>

  <!-- ALERTA -->
  <app-alert
    [message]="alertMessage"
    [type]="alertType"
    [visible]="showAlert"
    [confirm]="confirmAlert"
    (close)="showAlert = false"
    (confirmResult)="handleAlertConfirm($event)">
  </app-alert>
</form>